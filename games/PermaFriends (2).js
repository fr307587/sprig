
/*
@title: PermaFriends
@author: Ruben Figueroa Jr
@tags []

*/






    const player = "p"
    const enemies = "e"
    const goal = "g"
    const wall = "l"
    const box = "b"
const secondplayer = "s"
const trap = "t"
const key = "k"
const lock = "o"
const fakewall = "w"
const trapfake = "a"
const background = "q"


setLegend(
  [wall, bitmap`
3301031330100011
1111111130103110
0031331311111111
0001333133101000
0001333133011000
1111111111111111
0001333130110000
0331333131313331
1111111111111111
0001111133010000
0001133130311111
0011331111131000
1111113130001300
0101333130001330
3101333130001111
3111111111111003`],
  [goal, bitmap`
0000000000000000
0000000000000000
0000330003300000
0003333033330000
0033333333333000
0333833333833300
0333333333333300
0333333833333300
0033833333833000
0003383338330000
0000338383300000
0000033833000000
0000003330000000
0000000300000000
0000000000000000
0000000000000000`],
  [box,  bitmap`
................
................
...33CCCCCCCC33.
...333CCCCCC333.
...3333CCCC3333.
...CC333CC333CC.
...CCC337733CCC.
...CCCC3773CCCC.
...CCCC37733CCC.
...CCC337733CCC.
...CC333CC333CC.
...C333CCCC333C.
...333CCCCCC333.
...33CCCCCCCC33.
...33CCCCCCCC33.
................`],
  [ player, bitmap`
................
................
.....000000.....
....0......0....
...0..6..6..0...
...0........0...
...0.9....9.0...
...0..9669..0...
....0.......0...
.....0000000....
.......00.......
.....3.00.7.....
......3007......
.......00.......
.......00.......
......0..0......`],
  [secondplayer, bitmap`
...7770770777...
...7707777077...
...7077777707...
...7770770777...
...7770770777...
...7777777777...
...7777007777...
...7770770777...
.......737......
......77377.....
....77.737.77...
.......777......
.......7.7......
......77.77.....
................
................`],
[trap, bitmap`
................
........7.......
...7077777770...
..7770077700777.
.7777777777777..
.7777707770777..
..777777777777..
..777777777777..
..777777777777..
...7777007777...
....770000777...
.....7077077....
.....777777.....
......7777......
................
................`],
[key, bitmap`
................
................
......66.66.....
.....6666666....
....666363666...
...66666666666..
....663663666...
.....6633666....
......66666.....
.......666......
........6.......
......666.......
......666.......
........6.......
........6.......
........6.......`],
[lock, bitmap`
................
.............666
.6666..00000.060
.60606.00000.666
.6666..0.0.0..6.
...6.....0....6.
...6.....0...6..
...6.....0..6...
..CCCCCCCCCCCC..
..CCCCCCCCCCCC..
..CCCCCCCCCCCC..
..CCCCCCCCCCCC..
................
................
................
................`],
[fakewall, bitmap`
L333313L1LLLLL11
L33331331L3L11LL
L3L3313311311LLL
LL3331333113LL11
LL333133113111LL
111111111113LLLL
LL33311331333LL1
11111111113L111L
1L33113311113LLL
LL33111133113LLL
LL311333331111LL
111113333311311L
1111111111111111
11L31L33L3313LL1
LL331L3333313LLL
LLL3133LL3L11LLL`],
[trapfake, bitmap`
LL3LL1L313111111
LL3L313L1113LLL1
LL3L31331313LLLL
L11111111313LLLL
1L3333111313LLL3
LL33331L1111LLL3
LL33L31313L11133
1113L31313L1311L
LL31111111111111
L3311111133133L1
L311313111313LLL
3133133113113LLL
L1331L31133L11L1
L131111113331111
L1L11LL111111LL1
L111LLL1313L1LLL`],
[background, bitmap`
1111111111111111
1111111111111111
1111111111111111
1111111111111111
1111111111111111
1111111111111111
1111111111111111
1111111111111111
1111111111111111
1111111111111111
1111111111111111
1111111111111111
1111111111111111
1111111111111111
1111111111111111
1111111111111111`]);






  
  
  


setSolids([ player, wall, box, secondplayer, lock ]);

let level = 0

    const melody = tune`
167.5977653631285: A5/167.5977653631285 + C4/167.5977653631285,
167.5977653631285: G5/167.5977653631285 + D4/167.5977653631285,
167.5977653631285: F5/167.5977653631285 + E4/167.5977653631285 + C4/167.5977653631285,
167.5977653631285: E5/167.5977653631285 + F4/167.5977653631285 + C4/167.5977653631285,
167.5977653631285: G4/167.5977653631285 + D5/167.5977653631285 + E4~167.5977653631285 + C4/167.5977653631285,
167.5977653631285: C5/167.5977653631285 + A4/167.5977653631285 + E4~167.5977653631285 + C4/167.5977653631285,
167.5977653631285: E4~167.5977653631285,
167.5977653631285: C5~167.5977653631285 + C4/167.5977653631285,
167.5977653631285: D4/167.5977653631285,
167.5977653631285: D5~167.5977653631285 + C4/167.5977653631285,
167.5977653631285: D5~167.5977653631285 + D4/167.5977653631285,
167.5977653631285: D5~167.5977653631285 + F4~167.5977653631285 + B4~167.5977653631285,
167.5977653631285: E5~167.5977653631285 + C4^167.5977653631285 + B4~167.5977653631285,
167.5977653631285: E5~167.5977653631285 + D4^167.5977653631285 + B4~167.5977653631285 + A4~167.5977653631285,
167.5977653631285: E5~167.5977653631285 + E4^167.5977653631285 + C4-167.5977653631285 + A4~167.5977653631285,
167.5977653631285: G5~167.5977653631285 + F4^167.5977653631285 + C4-167.5977653631285 + A4~167.5977653631285,
167.5977653631285: E4^167.5977653631285 + C4-167.5977653631285,
167.5977653631285: A4~167.5977653631285 + D4^167.5977653631285 + C4-167.5977653631285,
167.5977653631285: F5~167.5977653631285 + C4^167.5977653631285,
167.5977653631285: D4~167.5977653631285,
167.5977653631285: C5~167.5977653631285 + F5~167.5977653631285 + C4~167.5977653631285 + E4-167.5977653631285,
167.5977653631285: E5^167.5977653631285 + D4~167.5977653631285 + F5~167.5977653631285 + A4~167.5977653631285 + G4~167.5977653631285,
167.5977653631285: C4~167.5977653631285 + D5~167.5977653631285 + E4-167.5977653631285,
167.5977653631285: C5~167.5977653631285 + E4-167.5977653631285 + C4^167.5977653631285,
167.5977653631285: G5^167.5977653631285 + B4~167.5977653631285 + E4-167.5977653631285 + G4~167.5977653631285 + F4~167.5977653631285,
167.5977653631285: A5^167.5977653631285 + C5~167.5977653631285 + E4-167.5977653631285 + F4~167.5977653631285 + C4^167.5977653631285,
167.5977653631285: A5^167.5977653631285 + G5^167.5977653631285 + D5~167.5977653631285 + D4~167.5977653631285 + C4~167.5977653631285,
167.5977653631285: G5^167.5977653631285 + C5~167.5977653631285 + D4~167.5977653631285 + C4-167.5977653631285 + F4~167.5977653631285,
167.5977653631285: B4~167.5977653631285 + E4~167.5977653631285 + C4-167.5977653631285,
167.5977653631285: F4~167.5977653631285 + A4~167.5977653631285 + C4-167.5977653631285,
167.5977653631285: B4~167.5977653631285 + E5~167.5977653631285 + G5/167.5977653631285 + C4-167.5977653631285 + D4~167.5977653631285,
167.5977653631285: C5~167.5977653631285 + C4~167.5977653631285 + E4^167.5977653631285 + E5^167.5977653631285 + G4-167.5977653631285`
  const playback = playTune(melody, Infinity)

const levels = [
  map`
........................
........................
........................
........................
........................
........................
........................
........................
........................
........................
........................
.........l....l.........
........................
........................
........................
........................
......l..........l......
.......l........l.......
........l......l........
.........l....l.........
lll.......llll.......lll
pgl..................lgs`,
  map`
...............
............t..
...............
............l..
...............
...............
...............
...............
...............
...............
...............
..l.........l..
.l.l.......l.l.
l.p.l.....l.s.l`,
  map`
l.......l..
..l.b.l...l
sl..l...b..
lllll..l.l.
ll.lll.l...
...b.l.l..l
l.l..l.ll.t
..ll.l.ll.l
.ll..b.l..l
..ltl.lll.l
l.ll...lt.t
.pll.lgllgl`,
  map`
.....pl......s
..l..ll.l..lll
....lllbl.....
ll....l...l...
.l.blbl....bll
..t.l.l.ll....
......l..l.tl.
gl....l.....lg`,
  map`
gl.....b.t..
...lll.l..l.
llltl.......
.....b.lblll
..l.ll...b..
llll..lp..l.
lt..l.b..ll.
....b..l..l.
.l.lttllllls
.llllllgllll
........llll`,
  map`
.gl..lll.l.bs
.l...lll....b
.ll..lll.l.l.
..l..lll.....
l.l..lll..l.l
.b...lll...t.
.ll..lll.b.l.
..l.llllll..l
..l...lll...l
.l.l.b.ll.lt.
p.b..lg....l.`,
  map`
p.lllllllllllll
.b.l...b...lg.l
l...l....l..l.l
ll.....l......l
l...lb..lll.l.l
l..ll....ll...l
lb.l..l..b....l
l..l.llgl..ll.l
l..l...l..l.l.l
l............b.
lllllllllllll.s`,
  map`
lplllsl
t..l..t
ll.ll..
l..l.l.
l.ll...
...llbl
lt.l...
.l.lt..
...ll..
.lll..l
..tlblg
l.ll...
g.ll.lt`,
  map`
g......llllllll
llllllwllllllll
l.b.....lllllll
..lllllllllllll
.ll..bpsb......
..l..lllll..ll.
l.ll.llllll.b.l
..l..lllllll.ww
l...lllllll..lg`,
  map`
pl.l......t...
.....t.lll.l..
l.l..l...l..l.
....l...t..tl.
.l...ll.ll...l
...l..l....l.g
llllllllllllll
s.l.....t.....
....l.ll..l.lt
.llllll.l..l..
........t..l.l
.l.ll..l.l....
t..lll.....tlg`,
  map`
ls...ttl..t.t.g
plll......l...t
...llltt...t.t.
.l....ll.t.....
.....l.ll...tl.
tl.lt.l.lll...t
......ll.llllll
l....l.t....lll
.ltl....lllllgl
....ltl........`,
  map`
p.......ll.......s
lwlllllalllllalwll
........ll........
wllalllllllwllllal
........ll........
allllwlllllallllwl
........ll........
lwllllallllllwllla
........ll........
llallllwlllwllllal
........ll........
wllllalllllallllwl
.......gllg.......`,
  map`
s.l.l....l.t..l...lp
.l..w...lw..l.l.t.lb
..bl.ll...l..l..lll.
l....tl...l.......l.
.a..l.ll.tll...l..w.
..l.l..l...ll..l..l.
.tl....a...wl..l....
l..lllallal.tl..t..l
gl.....ll.....ll.l..
.tl.lt..wll.llllllll
....t.la....w......g`,
  map`
t..gl......l..
...ll..ll..ll.
.bl...t.l...l.
t.l..llll..t..
..b.......l.ll
lllll....l....
pb.l...l.lwl.s
.b...l.l.lwll.
llbl..l..awwll
......l..llwlt
...l.l.l.l....
..ll.......tlw
....lll.tl.l.g`,
  map`
t..tl..tl....s
lal...l...l..l
g..wll..tlll..
lal.ll.l..l.ll
t.l......w...t
l.tlttl.l.t.ll
..l..l.wtll.l.
l.t.l..l.....t
...l..t.ltl.bl
pl...l.l..lw.g`,
  map`
s.l......b.....l....p
l.lltlgll...l...l....
...t..lllb.t..l..all.
ll....lll.l...l....bw
.ll.lt.ll.w.lllll...t
........ll.l..t...ll.
llt.l.l.ll...lllllt.l
...l..t.l.l..........
.l...l..al..ll.t..l..
..llllll..l..l..l.t..
l..t...t....l.....ll.
..l.w..l.l....l..l...
.w..l......tl..t.lgll`,
  map`
.ta..p.l..tl..
.l.....l.l....
..l...l....ll.
.lll....l.ll..
..w.ll.t....t.
wll....lllll.l
.wat.ll.......
l.lll...llllll
l..wall.l..t.s
w.l...lllttt.t
.ll.tl..w....t
tl..l.l.llllll
a..t....l...l.
l..ll..l..l.wl
.l..ll...lll.w
..w..lt.al.t..
gl.l.t.l....lg`,
  map`
p....t.l.....s
...l...ltl.l..
.lllll.l...t..
.l.....l...ll.
.t..l..l.l..ll
l...ll.l..l.t.
..tll..l...l..
t.l.ll.l...l..
l..ll.tl.t....
.l.l...llllll.
.l...gllg.....`,
  map`
l.....llll......t.....p
t.lll.bwa...b....ll....
l.l..lgl..tlllt....ll..
t.l..llll....l....l.ll.
l.ll...l.t.l.lll.tl....
l.tll.....llll....b.t.t
...tllt.l..t.....lll.t.
t.t.t.l.l....lltt..w.l.
..t.l.b.l.t.ll..b..l..l
.ll....tlllll...l..ll.l
.l.t.l..t....b.l....l.s
...b.lll....ll.l..l.l..
...lll....ll...t...ll..
tlll...l.......l..ll...
..b..l...llllll.l..b.tl
g..l...t........t...l..`,
  map`
gt...llt.t.g
.t..tll.t.t.
.tt..ll..t..
...tplls.t.t
tt...ll.t...
...t.ll...t.`,
  map`
sb....w....t.
...t.l..t....
tlt..at...t..
...t.l...t..g
lllllllllllll
......tlb...g
t..t...w.tb..
..b...ta...t.
p.t.t..lt.t..`,
  map`
llllllllllllll
l...b.p......l
lw.l..b.lllall
lgll.l.......l
l.lll.....l..l
l.l.lllal.ll.l
l.......allgal
l....l...l.wll
l.l...ll..l..l
lll.l...l...ll
l...l........l
l.l.lll..l.l.l
l......b..ll.l
l..ll.bsb....l
llllllllllllll`,
  map`
plls
bllb
.ll.
.ll.
.ll.
.ll.
.ll.
.ll.
.ll.
.ll.
.ll.
.ll.
.ll.
.gg.
.ll.`
  
  
  
]
 setPushables({
   [player]: [ box, player],
   [secondplayer]: [box, secondplayer]
 });



// Second Player Controls
onInput("j", () => {
  getFirst(secondplayer).x -= 1;
  const melody = tune`
46.36785162287481,
46.36785162287481: A5~46.36785162287481,
1391.0355486862443`
  playTune(melody)
});

onInput("i", () => {
  getFirst(secondplayer).y -= 1;
  const melody = tune`
42.796005706134096,
42.796005706134096: A5^42.796005706134096,
1283.8801711840229`
  playTune(melody)
});

onInput("k", () => {
  getFirst(secondplayer).y += 1;
  const melody = tune`
43.35260115606936,
43.35260115606936: A5-43.35260115606936,
1300.578034682081`
  playTune(melody)
});

onInput("l", () => {
  getFirst(secondplayer).x += 1; 
  const melody = tune`
41.43646408839779,
41.43646408839779: A5/41.43646408839779,
1243.0939226519338`
  playTune(melody)
});




// Setting the Map

setMap(levels[level])

// Normal Player Controls

onInput("a", () => {
 getFirst(player).x -= 1;
  const melody = tune`
94.9367088607595,
47.46835443037975: G4~47.46835443037975,
1376.5822784810127`
  playTune(melody)
});

onInput("s", () => {
	getFirst(player).y += 1
  const melody = tune`
37.5,
37.5: G4^37.5,
1125`
  playTune(melody)
});
onInput( "d", () => {
  getFirst(player).x += 1;
  const melody = tune`
37.5,
37.5: G4-37.5,
1125`
  playTune(melody)
});

onInput( "w", () => {
  getFirst(player).y -= 1;
  const melody = tune`
37.5,
37.5: G4/37.5,
1125`
  playTune(melody)
});





//setInterval(() => {
  


// Goal Switch / NextLevel

afterInput(() => {
const goalsCovered = tilesWith(player, goal).concat(tilesWith(secondplayer, goal));
const trapsCovered = tilesWith(player, trap).concat(tilesWith(secondplayer, trap));
const trapfakeCovered = tilesWith(player, trapfake).concat(tilesWith(secondplayer, trapfake));

if (trapsCovered.length > 0) {
  setMap(levels[level])
  const melody = tune`
245.9016393442623,
122.95081967213115: D5~122.95081967213115,
122.95081967213115: C5~122.95081967213115,
122.95081967213115: B4~122.95081967213115,
122.95081967213115: A4~122.95081967213115,
122.95081967213115,
122.95081967213115: G4~122.95081967213115,
2950.8196721311474`
  playTune(melody)
}

  if (trapfakeCovered.length > 0) {
    setMap(levels[level])
    const melody = tune``
    playTune = (melody)
  }


  
if (goalsCovered.length >= 2)  {
  level = level + 1;

  if (level < levels.length) {
    setMap(levels[level]);

} 
  else {
    playback.end()     // Win Screen
    addText("Victory!!!", { y:4, color: color`6`});
const melody = tune `
157.89473684210526: C4/157.89473684210526,
157.89473684210526: D4^157.89473684210526,
157.89473684210526: E4-157.89473684210526 + F5/157.89473684210526,
157.89473684210526: D4^157.89473684210526 + E5/157.89473684210526,
157.89473684210526: F5/157.89473684210526 + C4/157.89473684210526,
157.89473684210526: D4^157.89473684210526 + G5/157.89473684210526,
157.89473684210526: C4^157.89473684210526,
157.89473684210526: E4-157.89473684210526,
157.89473684210526: F4^157.89473684210526,
157.89473684210526,
157.89473684210526: A4^157.89473684210526,
157.89473684210526: C5^157.89473684210526 + C4^157.89473684210526,
157.89473684210526,
157.89473684210526: G5^157.89473684210526 + D5~157.89473684210526 + D4^157.89473684210526,
157.89473684210526,
157.89473684210526: B4-157.89473684210526 + F4~157.89473684210526 + C4^157.89473684210526,
157.89473684210526: C5^157.89473684210526 + G4~157.89473684210526,
157.89473684210526: G4^157.89473684210526,
157.89473684210526: E5~157.89473684210526 + B4~157.89473684210526 + G4~157.89473684210526,
157.89473684210526: C5~157.89473684210526 + F5~157.89473684210526 + A4~157.89473684210526,
157.89473684210526: D5~157.89473684210526 + G5~157.89473684210526 + B4~157.89473684210526,
157.89473684210526: E5~157.89473684210526 + A5~157.89473684210526 + C5~157.89473684210526,
157.89473684210526: F5~157.89473684210526 + B5~157.89473684210526 + D5~157.89473684210526,
157.89473684210526: G5~157.89473684210526 + B5~157.89473684210526 + E5~157.89473684210526,
473.6842105263158,
157.89473684210526: C4~157.89473684210526,
157.89473684210526: D4~157.89473684210526,
157.89473684210526: E4~157.89473684210526,
157.89473684210526: D4~157.89473684210526,
157.89473684210526: C4~157.89473684210526`
    
   playTune(melody)
  }
  
}

});


if (level === 0){

  addText("Bill and Bob had", {
  x: 2, 
    y: 1,
    color:color`3` })

  addText("a fight and need", {

    x: 2,
    y:2,
    color:color`9` })

  addText("your help to ", {
    x:4,
    y:3,
    color:color`6` })

  addText("restore their", {
    x:4,
    y:4,
    color:color`4`})

  addText("FRIENDSHIP", {
    x:5,
    y:5,
    color:color`5`})

  addText("In haunted house!", {
    x:2,
    y:6,
    color:color`H`})
  
  addText("Press d/j to play!", {

    x: 1,
    y: 10,
    color:color`1`})

  


}
 


